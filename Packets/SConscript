# -*- python -*-

Import('env')
import SENFSCons, glob

###########################################################################

def makeAllIncludesHH(target, headers):
    file(env.File(target).abspath,"w").write("".join([ '#include "%s"\n' % f
                                                       for f in headers ]))

###########################################################################

source_headers = [ f for f in glob.glob("*.hh")
                   if 'defined(SENF_PACKETS_DECL_ONLY)' in file(f).read() ]
source_headers.sort()
makeAllIncludesHH('all_includes.hh', source_headers)

SENFSCons.StandardTargets(env)
SENFSCons.Lib(env,
              library = 'Packets',
              sources = SENFSCons.GlobSources(),
              LIBS = [ 'Socket', 'Utils' ])
SENFSCons.Doxygen(env, extra_sources = [
    env.Dia2Png("structure.dia")
])

SConscript(glob.glob("*/SConscript"))
